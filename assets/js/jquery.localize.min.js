/*!
 * jQuery.localize 08-03-2014
 * https://github.com/chaika-design/jQuery.localize
 */
var Localize=function(a){this.init(a)};jQuery.extend(Localize.prototype,{lang:"en",defLang:null,cache:{},options:{language:null,skipLanguage:null,pathPrefix:"",timeout:500,callBack:null},_normaliseLang:function(a){return a=a.replace(/_/,"-").toLowerCase(),a.length>3&&(a=a.substring(0,3)+a.substring(3).toUpperCase()),a},_saveCahe:function(a,b){var c={};return c[a]=b,this.cache[this.lang]||(this.cache[this.lang]={}),jQuery.extend(this.cache[this.lang],c),console.log(this.cache),this},_loadLanguage:function(a){var b=this.options.pathPrefix+"/"+this.lang+"/"+a+".json",c=jQuery.Deferred();return jQuery.ajax({url:b,timeout:this.options.timeout,dataType:"json",type:"post",success:c.resolve,error:c.reject}),c},_getValueForKey:function(a,b,c){var d,e;e=c[this.lang],d=b.split("."),d.push(a);for(var f=0,g=d.length;g>f;f+=1)b=d[f],e=null!==e&&e[b]?e[b]:null;return e},_dispatchEvent:function(a,b){return"function"==typeof a&&a(b),this},init:function(a){var b,c=this;jQuery.isPlainObject(a)&&(c.options=jQuery.extend({},c.options,a)),b=c.options,b.language&&(c.lang=c._normaliseLang(b.language)),b.skipLanguage&&(c.defLang=c._normaliseLang(b.skipLanguage))},transrate:function(a,b,c){var d,e,f=this,g=f.options;return c="function"==typeof c?c:g.callBack,this.lang===this.defLang?(f._dispatchEvent(c,a),a):(d=b.split(".")[0],f.cache[f.lang]&&f.cache[f.lang][d]?(e=f._getValueForKey(a,b,f.cache),e=e||a,f._dispatchEvent(c,e),e):void this._loadLanguage(d).done(function(g){f._saveCahe(d,g),e=f._getValueForKey(a,b,f.cache),f._dispatchEvent(c,e||a)}).fail(function(b,d,e){console.log(b,d,e),f._dispatchEvent(c,a)}))},language:function(a){a&&(this.lang=this._normaliseLang(a))},skipLanguage:function(a){a&&(this.defLang=this._normaliseLang(a))},reset:function(a){this.cache[a]?delete this.cache[a]:a||(this.cache={})}});